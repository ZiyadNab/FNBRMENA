const Data = require('../../FNBRMENA')
const FNBRMENA = new Data()
const FortniteAPI = require("fortnite-api-com");
const config = {
  apikey: FNBRMENA.APIKeys("FortniteAPI.com"),
  language: "en",
  debug: true
};

var Fortnite = new FortniteAPI(config);

module.exports = {
    commands: 'aes',
    expectedArgs: '',
    minArgs: 0,
    maxArgs: 0,
    cooldown: -1,
    permissionError: 'Sorry you do not have acccess to this command',
    callback: async (message, args, text, Discord, client, admin, alias, errorEmoji, checkEmoji) => {
        
        //get the user language from the database
        const lang = await FNBRMENA.Admin(admin, message, "", "Lang")

        Fortnite.AES("en")
        .then( async res => {
            var paks = ""
            var counter = 1
            if(lang == "en"){
                const generating = new Discord.MessageEmbed()
                generating.setColor('#BB00EE')
                const emoji = client.emojis.cache.get("805690920157970442")
                generating.setTitle(`Generating ... ${emoji}`)
                message.channel.send(generating)
                .then( async msg => {
                    for(let i = 0; i < res.data.dynamicKeys.length; i++){
                        if(!res.data.dynamicKeys[i].pakFilename.includes(".ucas")){
                            paks += "• Pak "+ counter +": " + res.data.dynamicKeys[i].pakFilename + "\n"
                            counter++
                        }
                    }
                    const AES = new Discord.MessageEmbed()
                    .setColor('#BB00EE')
                    .setTitle('AES key and paks')
                    .addFields(
                        {name: 'Build:', value: res.data.build},
                        {name: 'AES Key:', value: res.data.mainKey},
                        {name: 'Paks:', value: paks},
                    )
                    .setFooter('Generated By FNBRMENA Bot')
                    .setAuthor('FNBRMENA Bot', 'https://i.imgur.com/LfotEkZ.jpg', 'https://twitter.com/FNBRMENA')
                    await message.channel.send(AES);
                    msg.delete()
                }).catch(err => {
                    console.log(err);
                })
            }
            if(lang == "ar"){
                const generating = new Discord.MessageEmbed()
                generating.setColor('#BB00EE')
                const emoji = client.emojis.cache.get("805690920157970442")
                generating.setTitle(`يتم التحميل ... ${emoji}`)
                message.channel.send(generating)
                .then( async msg => {
                    for(let i = 0; i < res.data.dynamicKeys.length; i++){
                        if(!res.data.dynamicKeys[i].pakFilename.includes(".ucas")){
                            paks += "• باك "+ counter +": " + res.data.dynamicKeys[i].pakFilename + "\n"
                            counter++
                        }
                    }
                    const AES = new Discord.MessageEmbed()
                    AES.setColor('#BB00EE')
                    AES.setTitle('مفتاح الـ AES')
                    AES.addFields(
                        {name: 'التحديث:', value: res.data.build},
                        {name: 'مفتاح الـ AES:', value: res.data.mainKey},
                        {name: 'باك:', value: paks},
                    )
                    AES.setFooter('Generated By FNBRMENA Bot')
                    AES.setAuthor('FNBRMENA Bot', 'https://i.imgur.com/LfotEkZ.jpg', 'https://twitter.com/FNBRMENA')
                    await message.channel.send(AES);
                    msg.delete()
                }).catch(err => {
                    console.log(err);
                })
            }
        }).catch(err => {
        
        })
    },
}